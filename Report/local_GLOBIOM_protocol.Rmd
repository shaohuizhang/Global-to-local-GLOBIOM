---
title: "Global-to-local GLOBIOM procedure"
author: "Michiel van Dijk"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  word_document:
    reference_docx: ../Common/word_styles_01.docx
    
---

```{r setup, include=FALSE}
library(rprojroot)
root <- find_root(is_rstudio_project)

library(knitr)
knitr::opts_chunk$set(
  fig.width=12, fig.height=8,
  dpi = 300,
  echo=FALSE, warning=FALSE, message=FALSE,
  fig.path = file.path(root,"FigTabMap/out-"),
  dev = "CairoPNG",
  dev.args = list(CairoPNG = list(bg = "transparent"))
  )

library(pander)
panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)

#source(file.path(root, "Code/Fig.R"))
#source(file.path(root, "Code/Tab.R"))
source(file.path(root, "Code/Map.R"))
```

# Introduction
GLOBIOM has been designed as global asssessment tool. Most input data is defined at the [0.5 degree] spatial level. Recently, there has been increasing demand for regional and subnational assessments that focus an a specific geographical region. Examples are land use change studies for Brazil, Congo, Ethiopia and Indonesia and an assessment of the water-land-energy nexus in the Zambezi and Indus river basins.The global datasets that are normally used for assessments are too coarse to arrive at the level of detail that is demanded for this type of studies and therefore needs to be replaced more detailed information that have a higher spatial resolution, if available.  

This document describes the various steps to prepare GLOBIOM for regional or subnational assessments. Refining the land use and land cover data for subnational assessments can be very time and resource-demanding and demands a certain craftsmanship. It is recommended to only follow the full process for relative large projects that take at least around two years. It is also advisable to involve local partners and stakeholders to provide input data (e.g. land use maps and production statistics) and validate processed information (e.g. updated land use map that is used in GLOBIOM) 
 

# Data processing pipeline
Figure X shows a flowchart for all the steps to prepare the data. We will discuss them one by one. 

## Collect additional data
Preferably the following information should be updated in GLOBIOM:
- Area and production for each product (see Annex) by administrative unit in 2000 (and 2010)
- Land cover map classes by simulation unit for 2000 and (2010) [@Are there standard classes?]
- Protected areas map.
- Costs. At the moment only fertilizer and irrigation costs. Additional household data might improve the present information that is used in GLOBIOM, which is provided at a very high level (national/regional.)
- Productivity [?]

It highly depends on the region, which data is available and at which level. We recommend to take a pragmatic approach, using data from household surveys (e.g. LSMS-ISA, LSMS, etc), national statistics and specialised ministries and institutes. The following sections describe some rules of thumb that can be used to update the information.

## Area and production.
National statistics and household surveys provide the best information for detailed information on agricultural production. In most cases it should be possible to collect information on total production, crop area and/or harvested area at the second administrative level (e.g. province). Sometimes it will be necessary to add additional crops that are not part of the standard GLOBIOM crop classification (e.g. teff in Ethiopia) 

When production data is not available, another approach can be to collect information on average consumption or diets and combine this with population density maps to approximate total consumption at the level of the administrative unit. As in many poor countries, the agricultural sector is characterised by subsistince farming, consumption is a reasonable proxy for production in case no other information is available.

## Land cover map
Many countries publish detailed land cover maps, that provide information on the location of crop land, forest land, agro-industrial plantation (consessions), timeber plantations (concesstions), forest land, urbanised land and unused areas (i.e. rock). These maps can be used to improve the land cover map in GLOBIOM at the simulation unit level. 

## Harmonise data 
- Ensure to harmonise the administrative boundaries over time. In many countries they tend to change over time. 
- Compare data from different sources and over time.

## Downscale land use and production data
Code in GAMS is provided to downscale and harmonise the land use and land cover data to the GLOBIOM simu levels. Downscaling is performed using priors that provide information on the suitability of certain crops or transportation costs. Downscaling is mostly down for crops as only limited information tends to be available on livestock. It is a separate optimization problem for each of the administrative units for which detailed production data is collected and can therefore be treated as a large number of parallel processes. 


# GLOBIOM set up

# Regional module
- Creates one GDX file with all information for the region you are studying. 
- Add some lines in the aggregation phase, where regional data is replaced by new updated information.
-30 world regions

## Folder structure
Add a country case study folder in GAMS that will be used for all (sub)national statistics. It will have the same structure as a standard global data folder in GLOBIOM.

## Trade
Have to decide if you would keep one region or split countries. In latter case, adopt regional trade block and model trade with total block not bilaterally.
 
## Consumption

## Summary of steps
1. Download GADM maps for the target region



# STEP 1: Select administrative regions and download maps.
## Introduction
To improve the modelling with GLOBIOM, we want to use detailed information that is available at the subnational level. Data can defined at the grid level with resolutions of 5 arcmin or 0.5 degree, or at some the administrative area. Administrative areas include the country level and lower level subdivisions such as provinces, districts and departments ofting using country specific names. National statistics (and sometimes international institutions, @See section X) often provide information on agricultural producttion such as output, yield and inputs at an administrative area lower than country level. Alternatively, as will be shown in section @X, the researcher can also calculate these aggregates if detailed household surveys are available.

The size of administrative areas differ by country. For example, the first administrative area in Ethiopia are nine regional states (or *Kililoch*) that are based on ethnic territoriality (https://en.wikipedia.org/wiki/Subdivisions_of_Ethiopia). These are fairly large areas. In contrast, in Tanzania, the first administrative area is made up of thirty regions (or *mkoa*), which are much smaller in (https://en.wikipedia.org/wiki/Subdivisions_of_Tanzania). To select the appropriate region, the researcher needs to study administrative division of the target country and compare this with available statistics. 

```{r Fig_1, fig.show = 'hold', out.width='33%'}
# https://bookdown.org/yihui/bookdown/figures.html for figures side by side
ETH_adm
TZA_adm
```


After the choice is made, the appropriate map(s) can be downloaded from the GADM database (http://www.gadm.org). GADM is a saptial database of the location of the world's administrative areas for use in GIS software. The data are available in various formats and can be downloaded from the website. Be aware that the administrative areas of countries may change over time, in particular at the lower subdivions such as districts and divisions. For this reason the GADM is updated regularly but it is also possible to download older versions. 

## Script
__Download_GADM.r__. This script downloads the GADM maps. Different levels of administrative boundaries can be selected and the maps will be automatically saved in user-selected folder for later use.

# STEP2: Collect land cover map and scale to SIMUs 

## Introduction
Information on land cover are essential for modelling land use change with GLOBIOM. The standard land cover map in GLOBIOM is produced by @ADD and has a resolution of @ADD. Although useful for global assessments, the spatial resolution is too coarse and imprecise to analyse land use change at the subnational level. For this reason, it is important too replace the land cover map for the target country with updated and country specific information that is often published by national agencies and international institutions such as the FAO and the World Bank. 

To use the new land cover maps in GLOBIOM it is important to (1) the harmonise land cover classification and (2) map the data to the GLOBIOM SIMUs. Land cover information in GLOBIOM is provided at the six classes that are also used by the IPCC for reporting [@check] Table @X presents the six classes with definitions. This is a standard classification that in most cases will also be used for country specific land cover maps. It is also possible that a more detailed classification consisting of  12â€“15 country-specific classes is used. In such cases, the researcher needs to aggregate the data first before it can be processed further.[^1] The next step is to aggregate the land cover information to SIMU level and write them to GDX.

## Script
__Process_land_cover_map.r__. This script loads a country specific land use map, aggregates it to SIMU level and saves the information in GDX format. For the script to work, the land cover data needs to be presented in raster format. The following procedure is used to aggregate the land cover data:

1. Load the global SIMU 5 armin polygon map and select the target country using the iso3c country number. Load the country specific GADM map (only needed for making maps).
2. If needed, reproject the the SIMU polygon and the GADM map to the target country projection.
3. Overlay the land cover map with the SIMU polygon map and calculate the share of each land cover class per SIMU. We assume that all raster cells have the same size (which is approximately true if the area is not too large and area is location at a distance from the poles) and therefore we can use the relative number of cells by land cover class as a measure of relative land cover area.
4. Save the data in GDX format.


__Table X: Standard Land cover classes__

```{r Tab_1}
Tab_LC <- read_csv(file.path(root, "Data/Standard_land_cover_classes.csv"))
pander(Tab_LC)
```
###### Source: @Haack2015


```{r, message = FALSE, results='asis'}
getwd()
library(readxl)
library(knitr)
library(xtable)
products <- read_excel(file.path(root ,"Data/GLOBIOM_products.xlsx"))
kable(products)

```


# Footnotes
[^1] This can easily be done with R using the raster package. At the moment no code is provided for this. 